---
title: "Protobuf CVE Recursion Depth Bypass Fix"
date: "2026-02-04"
category: security-issues
tags: [protobuf, cve, dependabot, dependency-pinning, uv, transitive-dependency]
module: dependencies
severity: high
symptoms:
  - "Dependabot alert for protobuf CVE (CVSS 8.2, CWE-674)"
  - "Transitive dependency vulnerability via streamlit/yfinance"
  - "DoS via google.protobuf.json_format.ParseDict() recursion bypass"
resolution_time: "< 10 minutes"
---

# Protobuf CVE Recursion Depth Bypass Fix

## Problem

Dependabot alert #4 flagged `protobuf 6.32.1` for a high-severity vulnerability (CVSS 8.2, CWE-674). The CVE allows denial-of-service via `google.protobuf.json_format.ParseDict()` by bypassing recursion depth limits. The vulnerability is network-accessible, low complexity, requires no authentication, and has high availability impact. In this project, protobuf was not a direct dependency — it was pulled in transitively by `streamlit` and `yfinance`.

## Root Cause

Protobuf versions below 6.33.5 did not properly enforce recursion depth limits when parsing JSON format messages via `ParseDict()`. An attacker could craft deeply nested protobuf messages that bypass the intended recursion guards, causing stack exhaustion and process crash.

## Solution

Pin `protobuf>=6.33.5` as a direct dependency in `pyproject.toml` to override the transitive resolution:

```toml
# pyproject.toml — add to dependencies array
"protobuf>=6.33.5",
```

Then regenerate the lock file targeting only protobuf:

```bash
uv lock --upgrade-package protobuf
uv sync
```

### Verification

```bash
# Confirm version in lock file
rg 'name = "protobuf"' uv.lock -A 2
# Expected: version = "6.33.5" (or higher)

# Run tests
uv run pytest
# Expected: all tests pass with no regressions
```

## Why This Pattern Works

When a _transitive_ dependency has a CVE but its parent packages haven't updated yet, adding a direct dependency constraint in `pyproject.toml` forces the resolver (`uv`) to use the patched version. The `--upgrade-package` flag targets only the specific package without disturbing the rest of the lock file.

This is preferable to:
- Waiting for upstream packages to bump their constraints (slow, uncertain)
- Using `uv lock --upgrade` which upgrades _everything_ (risky, noisy diff)

## Prevention

1. **Enable Dependabot alerts** on the GitHub repo (already active)
2. **Pin security-critical transitive deps** as direct deps when alerts fire
3. **Review Dependabot alerts promptly** — high-severity CVEs (CVSS >= 7.0) should be patched same-day
4. **Run `uv run pytest` after every dependency change** to catch compatibility issues immediately

## References

- [Dependabot Alert #4](https://github.com/AojdevStudio/Finance-Guru/security/dependabot/4)
- Commit: `b976355` — `fix(security): upgrade protobuf to >=6.33.5 for CVE recursion depth bypass`
- CWE-674: Uncontrolled Recursion
- CVSS: 8.2 (High) — Network / Low complexity / No auth / High availability impact
