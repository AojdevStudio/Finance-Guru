---
phase: 10-self-assessment-persistence-topics
plan: 03
type: execute
wave: 2
depends_on: ["10-01", "10-02"]
files_modified:
  - src/explorer/dist/options-greeks-explorer.html
  - src/explorer/dist/risk-management-explorer.html
  - src/explorer/dist/dividend-strategy-explorer.html
autonomous: false

must_haves:
  truths:
    - "All 3 explorers (dividend, options-greeks, risk-management) build successfully from their topic JSONs"
    - "Each built explorer is a single standalone HTML file with zero external dependencies"
    - "Each explorer loads in under 1 second from local filesystem"
    - "Knowledge state persists after page refresh in each explorer"
    - "Learning mode selector changes prompt output in each explorer"
    - "Copy prompt button functions correctly"
    - "Explorer is usable on mobile viewport (responsive sidebar, touch tap to cycle)"
  artifacts:
    - path: "src/explorer/dist/dividend-strategy-explorer.html"
      provides: "Rebuilt dividend explorer with Phase 10 enhancements"
      min_lines: 100
    - path: "src/explorer/dist/options-greeks-explorer.html"
      provides: "Options Greeks knowledge explorer"
      min_lines: 100
    - path: "src/explorer/dist/risk-management-explorer.html"
      provides: "Risk Management knowledge explorer"
      min_lines: 100
  key_links:
    - from: "src/explorer/build.ts"
      to: "src/explorer/topics/options-greeks.json"
      via: "Build pipeline produces standalone HTML"
      pattern: "bun run.*build\\.ts.*options-greeks"
    - from: "src/explorer/build.ts"
      to: "src/explorer/topics/risk-management.json"
      via: "Build pipeline produces standalone HTML"
      pattern: "bun run.*build\\.ts.*risk-management"
---

<objective>
Build all 3 knowledge explorers using the enhanced template and new topic JSONs, then verify that all Phase 10 features work correctly in the generated HTML files.

Purpose: Integration testing -- confirm that topic data + enhanced template produce working explorers with persistence, learning modes, clipboard, and mobile support. This is the proof that Phase 10 delivers on its success criteria.
Output: 3 standalone HTML explorer files in dist/, verified working.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-self-assessment-persistence-topics/10-01-SUMMARY.md
@.planning/phases/10-self-assessment-persistence-topics/10-02-SUMMARY.md
@.planning/phases/09-template-engine-dividend-topic-port/09-RESEARCH.md

Plan 10-01 SUMMARY provides: Two topic JSON files created and validated
Plan 10-02 SUMMARY provides: Template engine enhanced with persistence, learning modes, clipboard, mobile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build all 3 explorers and verify output</name>
  <files>
    src/explorer/dist/dividend-strategy-explorer.html
    src/explorer/dist/options-greeks-explorer.html
    src/explorer/dist/risk-management-explorer.html
  </files>
  <action>
Run the Phase 9 build pipeline for all 3 topic JSON files to produce standalone HTML explorers.

1. **Build dividend explorer** (rebuilds with Phase 10 enhancements):
```bash
cd /Users/ossieirondi/Documents/Irondi-Household/family-office
bun run src/explorer/build.ts src/explorer/topics/dividend-strategy.json
```

2. **Build options-greeks explorer:**
```bash
bun run src/explorer/build.ts src/explorer/topics/options-greeks.json
```

3. **Build risk-management explorer:**
```bash
bun run src/explorer/build.ts src/explorer/topics/risk-management.json
```

4. **Verify all outputs exist and are standalone:**
```bash
# Check files exist
ls -la src/explorer/dist/*.html

# Verify each is a single file with no external script/link references
for f in src/explorer/dist/*.html; do
  echo "=== $(basename $f) ==="
  echo "Size: $(wc -c < $f) bytes"
  # Check for external references that would break standalone requirement
  grep -c '<script src=' "$f" || true
  grep -c '<link rel="stylesheet" href=' "$f" || true
done
```

5. **Verify performance constraint (EXPL-16):**
```bash
# Each file should be under ~1MB (reasonable for standalone with Cytoscape.js bundled)
for f in src/explorer/dist/*.html; do
  size=$(wc -c < "$f")
  echo "$(basename $f): $size bytes ($(($size / 1024)) KB)"
  if [ $size -gt 1048576 ]; then
    echo "WARNING: File exceeds 1MB"
  fi
done
```

6. **Verify topic data is embedded:**
```bash
# Each explorer should contain its topic title
grep -l "Options Greeks Explorer" src/explorer/dist/options-greeks-explorer.html
grep -l "Risk Management Explorer" src/explorer/dist/risk-management-explorer.html
grep -l "Dividend" src/explorer/dist/dividend-strategy-explorer.html
```

7. **Verify Phase 10 features are present in built output:**
```bash
for f in src/explorer/dist/*.html; do
  echo "=== $(basename $f) ==="
  # localStorage persistence
  grep -c "localStorage" "$f"
  # 4 knowledge states
  grep -c "unknown.*familiar.*confident.*mastered" "$f" || grep -c "KNOWLEDGE_STATES" "$f"
  # Learning modes
  grep -c "mode-selector" "$f"
  # Clipboard
  grep -c "clipboard" "$f"
  # Responsive CSS
  grep -c "max-width.*768px" "$f"
done
```

If any build fails:
- Check the error message from the build script
- Common issues: malformed JSON (fix in topic file), missing template files (check Phase 9 outputs exist), TypeScript errors (fix in explorer.ts)
- Re-run the failing build after fixing

If external references are found in the output:
- This violates the zero-dependency constraint (EXPL-16)
- Check build.ts inline logic -- all JS and CSS must be inlined into the HTML
  </action>
  <verify>
```bash
cd /Users/ossieirondi/Documents/Irondi-Household/family-office

# All 3 files exist
test -f src/explorer/dist/dividend-strategy-explorer.html && echo "dividend: OK" || echo "dividend: MISSING"
test -f src/explorer/dist/options-greeks-explorer.html && echo "options-greeks: OK" || echo "options-greeks: MISSING"
test -f src/explorer/dist/risk-management-explorer.html && echo "risk-management: OK" || echo "risk-management: MISSING"

# No external script/link references (zero means standalone)
for f in src/explorer/dist/*.html; do
  ext_scripts=$(grep -c '<script src=' "$f" 2>/dev/null || echo 0)
  ext_links=$(grep -c '<link.*href=.*\.css' "$f" 2>/dev/null || echo 0)
  echo "$(basename $f): external scripts=$ext_scripts, external CSS=$ext_links"
done

# Phase 10 features present
for f in src/explorer/dist/*.html; do
  has_storage=$(grep -c "localStorage" "$f")
  has_modes=$(grep -c "mode-selector" "$f")
  has_clipboard=$(grep -c "clipboard" "$f")
  echo "$(basename $f): localStorage=$has_storage, modes=$has_modes, clipboard=$has_clipboard"
done
```
  </verify>
  <done>
- All 3 explorer HTML files exist in src/explorer/dist/
- Each is a single standalone file (zero external script/CSS references)
- Each contains Phase 10 features (localStorage, learning modes, clipboard, responsive CSS)
- File sizes are reasonable (under 1MB each)
- Topic-specific content is embedded in each file
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Three standalone knowledge explorer HTML files with Phase 10 interactive features:
1. Dividend Strategy Explorer (rebuilt with enhancements)
2. Options Greeks Explorer (new)
3. Risk Management Explorer (new)

Features to verify:
- 4-state knowledge cycling (unknown/familiar/confident/mastered)
- localStorage persistence (survives page refresh)
- Learning mode selector (guided/standard/yolo changes prompt)
- Copy prompt button
- Mobile responsive layout
  </what-built>
  <how-to-verify>
Open each explorer in a browser and test:

1. **Open Options Greeks Explorer:**
   ```bash
   open src/explorer/dist/options-greeks-explorer.html
   ```

2. **Test knowledge cycling:**
   - Click the "Delta" node on the graph
   - Verify it cycles: unknown (red) -> familiar (yellow) -> confident (blue) -> mastered (green)
   - Click again to verify it wraps back to unknown
   - Check the sidebar shows the updated knowledge badge

3. **Test localStorage persistence:**
   - Set a few nodes to different knowledge states
   - Refresh the page (Cmd+R / F5)
   - Verify the knowledge states are restored

4. **Test learning mode selector:**
   - Click "Guided" in the header -- verify the generated prompt uses simpler language ("I'm a beginner learning about...")
   - Click "YOLO" -- verify the prompt uses advanced language ("Advanced study of...", mentions edge cases)
   - Click "Standard" to return to default

5. **Test copy prompt:**
   - Click the "Copy" button
   - Paste (Cmd+V) into a text editor
   - Verify the prompt text was copied correctly

6. **Test mobile responsive (in Chrome DevTools):**
   - Open Chrome DevTools (Cmd+Option+I)
   - Toggle device toolbar (Cmd+Shift+M)
   - Select iPhone 14 or similar mobile viewport
   - Verify sidebar moves below the graph canvas
   - Verify you can scroll the sidebar independently

7. **Repeat quick check on Risk Management Explorer:**
   ```bash
   open src/explorer/dist/risk-management-explorer.html
   ```
   - Verify concepts load (VaR, Sharpe Ratio, etc.)
   - Click a node to cycle knowledge state
   - Verify learning mode selector is present

8. **Verify load performance (EXPL-16):**
   - Each page should render the graph within 1 second of opening
   - No loading spinner, no external network requests
  </how-to-verify>
  <resume-signal>Type "approved" if all features work correctly, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
Phase 10 success criteria verification:
1. [SC-1] Clicking a concept node cycles through knowledge states (unknown -> familiar -> confident -> mastered) and the state persists after page refresh via localStorage -- verified by human in checkpoint
2. [SC-2] Learning mode selector (guided/standard/yolo) changes the complexity of generated prompts -- verified by human in checkpoint
3. [SC-3] "Copy prompt" button works on Chrome, Safari, and Firefox -- verified by human (at least Chrome)
4. [SC-4] Options-greeks and risk-management topic explorers are generated and functional -- verified by build output + human in checkpoint
5. [SC-5] All explorer pages load in under 1 second with zero external runtime dependencies -- verified by build checks + human observation
</verification>

<success_criteria>
- All 3 explorer HTML files build successfully
- Human verifies knowledge cycling, persistence, learning modes, clipboard, and mobile layout work
- All Phase 10 success criteria from ROADMAP.md are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/10-self-assessment-persistence-topics/10-03-SUMMARY.md`
</output>
