---
phase: 11-self-assessment-persistence-topics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/explorer/schemas/topic-schema.ts
  - src/explorer/topics/options-greeks.json
  - src/explorer/topics/risk-management.json
autonomous: true

must_haves:
  truths:
    - "Options-greeks topic JSON passes Zod schema validation at build time"
    - "Risk-management topic JSON passes Zod schema validation at build time"
    - "Zod schema accepts all 7 knowledge values (3 legacy + 4 new) with default 'unknown'"
    - "Each topic has exactly 20 concepts across 5 categories with exactly 22 edges"
    - "Every node ID appears in at least one edge (no orphan nodes)"
    - "Concept descriptions are practitioner-level with concrete numbers, formulas, or fund tickers"
  artifacts:
    - path: "src/explorer/schemas/topic-schema.ts"
      provides: "Updated Zod schema with backward-compatible knowledge enum"
      contains: "familiar, confident, mastered"
    - path: "src/explorer/topics/options-greeks.json"
      provides: "Options Greeks topic data for knowledge explorer"
      contains: "delta, gamma, theta, vega, rho"
    - path: "src/explorer/topics/risk-management.json"
      provides: "Risk Management topic data for knowledge explorer"
      contains: "var, cvar, sharpe-ratio, position-sizing"
  key_links:
    - from: "src/explorer/topics/options-greeks.json"
      to: "src/explorer/schemas/topic-schema.ts"
      via: "Zod schema validation at build time"
      pattern: "TopicSchema.safeParse"
    - from: "src/explorer/topics/risk-management.json"
      to: "src/explorer/schemas/topic-schema.ts"
      via: "Zod schema validation at build time"
      pattern: "TopicSchema.safeParse"
    - from: "src/explorer/schemas/topic-schema.ts"
      to: "src/explorer/topics/dividend-strategy.json"
      via: "Backward compatibility -- legacy 'fuzzy' default still validates"
      pattern: "z.enum.*fuzzy"
---

<objective>
Create two new topic data JSON files (options-greeks and risk-management) and update the Zod schema to support the Phase 11 4-state knowledge model while preserving backward compatibility with Phase 10's 3-state model.

Purpose: Deliver the content layer for EXPL-09a and EXPL-09b (curated financial concept graphs) AND the schema foundation that Plan 11-02's 4-state knowledge cycling requires. The schema update must happen here because the new topic JSONs use "unknown" as default and must pass validation.
Output: Two validated topic JSON files and an updated Zod schema that accepts both legacy and new knowledge values.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-self-assessment-persistence-topics/11-RESEARCH.md
@.planning/phases/10-template-engine-dividend-topic-port/10-RESEARCH.md

Reference the Phase 10 Zod schema in `src/explorer/schemas/topic-schema.ts` and existing `dividend-strategy.json` as the format exemplar.

Research provides:
- Complete curated concept graphs for both topics (20 nodes, 5 categories, 22 edges each)
- Schema migration strategy (Open Question 1): extend Zod enum to 7 values with `.default("unknown")`
- Pitfall 1: knowledge schema mismatch between Phase 10 and 11 -- must update schema before new JSONs validate
- Pitfall 7: disconnected concept graphs -- every node must have at least one edge
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Zod schema knowledge enum for 4-state model</name>
  <files>src/explorer/schemas/topic-schema.ts</files>
  <action>
Read the Phase 10 Zod schema in `src/explorer/schemas/topic-schema.ts`. Find the knowledge enum field (expected: `z.enum(["know", "fuzzy", "unknown"])` or similar).

Update it to accept ALL 7 values -- 3 legacy + 4 new:

```typescript
z.enum(["know", "fuzzy", "unknown", "familiar", "confident", "mastered"]).default("unknown")
```

Why 7 values, not just 4: Backward compatibility. The existing `dividend-strategy.json` has nodes with `"knowledge": "fuzzy"` as default. If the schema only accepts the 4 new states, the dividend topic build breaks. By accepting all 7, both old and new topic data validates.

Why `.default("unknown")`: New topics (options-greeks, risk-management) default to "unknown" which is the first state in the Phase 11 4-state cycle. Existing dividend topic keeps its "fuzzy" defaults explicitly set in its JSON.

This is a one-line change. Do NOT modify any other part of the schema file. Do NOT rename fields, change types, or alter the schema structure.

After editing, verify the existing dividend-strategy.json still conforms by checking that "fuzzy" is in the accepted enum values.
  </action>
  <verify>
Read the updated schema file and confirm:
1. The knowledge enum includes all 7 values: "know", "fuzzy", "unknown", "familiar", "confident", "mastered"
2. The default is "unknown"
3. No other changes were made to the schema

```bash
cd /Users/ossieirondi/Documents/Irondi-Household/family-office
grep -n "enum\|knowledge" src/explorer/schemas/topic-schema.ts
```
  </verify>
  <done>Zod schema accepts all 7 knowledge values with "unknown" as default. Existing dividend-strategy.json remains valid (its "fuzzy" defaults are in the accepted enum).</done>
</task>

<task type="auto">
  <name>Task 2: Create options-greeks and risk-management topic JSONs</name>
  <files>src/explorer/topics/options-greeks.json, src/explorer/topics/risk-management.json</files>
  <action>
Create both topic JSON files following the Phase 10 TopicSchema format. Use the EXACT curated concept graphs from 11-RESEARCH.md.

**For `src/explorer/topics/options-greeks.json`:**

Read the existing `src/explorer/topics/dividend-strategy.json` as the format exemplar. Match its structure exactly.

Structure:
- `metadata`: title "Options Greeks Explorer", slug "options-greeks", version "1.0.0", description about options Greeks concept map
- `categories`: 5 categories with IDs and colors from research:
  - core-greeks (#58a6ff), option-fundamentals (#3fb950), time-effects (#d29922), volatility-effects (#f85149), strategy-impact (#bc8cff)
- `nodes`: All 20 nodes from research with fields: id (kebab-case), label (human-readable), category (category ID), description (practitioner-level, 2-3 sentences with concrete numbers/formulas), knowledge ("unknown"), tags (array of relevant keywords)
  - Node IDs: delta, gamma, theta, vega, rho, option-premium, intrinsic-value, extrinsic-value, moneyness, implied-volatility, time-decay-acceleration, expiration-dynamics, dte-impact, iv-crush, iv-skew, vol-regime, delta-hedging, gamma-risk, theta-harvesting, vega-trading
- `edges`: All 22 edges from research with fields: source, target, label (relationship verb), type (optional)
  - Edge list: delta->gamma, gamma->delta-hedging, theta->time-decay-acceleration, vega->implied-volatility, option-premium->intrinsic-value, option-premium->extrinsic-value, moneyness->delta, moneyness->gamma, implied-volatility->iv-crush, implied-volatility->iv-skew, implied-volatility->vol-regime, time-decay-acceleration->expiration-dynamics, dte-impact->theta, dte-impact->vega, dte-impact->gamma, gamma-risk->gamma, theta-harvesting->theta, vega-trading->vega, delta-hedging->gamma-risk, iv-crush->vega-trading, vol-regime->theta-harvesting, rho->dte-impact
- `presets`: 4 presets: "All" (all nodes), "Core Greeks" (core-greeks category), "Volatility & Time" (time-effects + volatility-effects), "Strategy Applications" (strategy-impact)
- `promptTemplate`: Options-domain-specific intro/prefixes/outro. Use verbs appropriate for the domain (e.g., "I need to understand how [concept] affects my options positions").

**For `src/explorer/topics/risk-management.json`:**

Same format. Use the research's risk-management curated graph.

- `metadata`: title "Risk Management Explorer", slug "risk-management", version "1.0.0"
- `categories`: 5 categories from research:
  - risk-measurement (#f85149), performance-metrics (#58a6ff), position-management (#3fb950), portfolio-diversification (#d29922), risk-control-strategies (#bc8cff)
- `nodes`: All 20 nodes from research with IDs: var, cvar, volatility, beta, max-drawdown, sharpe-ratio, sortino-ratio, alpha, calmar-ratio, position-sizing, kelly-criterion, stop-loss, concentration-risk, diversification, correlation, asset-allocation, rebalancing, hedging, vol-regime-awareness, tail-risk
- `edges`: All 22 edges from research
- `presets`: 5 presets: "All", "Risk Measurement", "Performance & Metrics", "Position & Portfolio" (position-management + portfolio-diversification), "Risk Controls" (risk-control-strategies)
- `promptTemplate`: Risk-management-domain-specific intro/prefixes/outro

Key quality rules:
1. Descriptions MUST be practitioner-level, not textbook definitions. Include real numbers ("SPY's worst: -56% in 2008"), formulas ("f* = (bp - q) / b"), and actionable context. Copy descriptions verbatim from research where provided.
2. ALL edge source/target must reference valid node IDs. Cross-validate before saving.
3. Do NOT invent concepts or edges beyond what the research provides. Use EXACTLY 20 nodes and 22 edges per topic.
4. All node knowledge defaults to "unknown" (uses the updated schema default).
  </action>
  <verify>
Validate both JSONs are well-formed and structurally correct:

```bash
cd /Users/ossieirondi/Documents/Irondi-Household/family-office

python3 -c "
import json, sys

for topic in ['options-greeks', 'risk-management']:
    path = f'src/explorer/topics/{topic}.json'
    with open(path) as f:
        d = json.load(f)

    nodes = len(d['nodes'])
    edges = len(d['edges'])
    cats = len(d['categories'])
    presets = len(d['presets'])
    node_ids = {n['id'] for n in d['nodes']}
    cat_ids = {c['id'] for c in d['categories']}

    # Check edge integrity
    bad_edges = [e for e in d['edges'] if e['source'] not in node_ids or e['target'] not in node_ids]

    # Check all nodes reference valid categories
    bad_cats = [n['id'] for n in d['nodes'] if n['category'] not in cat_ids]

    # Check orphan nodes (no edges)
    edge_nodes = set()
    for e in d['edges']:
        edge_nodes.add(e['source'])
        edge_nodes.add(e['target'])
    orphans = node_ids - edge_nodes

    # Check knowledge defaults
    bad_knowledge = [n['id'] for n in d['nodes'] if n.get('knowledge', 'unknown') not in ['unknown', 'fuzzy', 'know', 'familiar', 'confident', 'mastered']]

    print(f'=== {topic} ===')
    print(f'Nodes: {nodes}, Edges: {edges}, Categories: {cats}, Presets: {presets}')
    print(f'Bad edges (dangling refs): {len(bad_edges)}')
    print(f'Bad categories: {bad_cats}')
    print(f'Orphan nodes: {orphans}')
    print(f'Bad knowledge values: {bad_knowledge}')

    errors = []
    if nodes != 20: errors.append(f'Expected 20 nodes, got {nodes}')
    if edges != 22: errors.append(f'Expected 22 edges, got {edges}')
    if cats != 5: errors.append(f'Expected 5 categories, got {cats}')
    if bad_edges: errors.append(f'Dangling edges: {bad_edges}')
    if bad_cats: errors.append(f'Invalid categories: {bad_cats}')
    if orphans: errors.append(f'Orphan nodes: {orphans}')
    if bad_knowledge: errors.append(f'Invalid knowledge: {bad_knowledge}')

    if errors:
        for e in errors:
            print(f'  FAIL: {e}')
        sys.exit(1)
    else:
        print('  All checks PASSED')
"
```
  </verify>
  <done>Both topic JSONs exist with 20 nodes, 22 edges, 5 categories each, zero dangling edge references, zero orphan nodes, valid knowledge defaults, and practitioner-level descriptions matching research.</done>
</task>

</tasks>

<verification>
All three data files pass:
1. Zod schema accepts 7 knowledge values with "unknown" default
2. Both JSONs are valid JSON (python3 -m json.tool)
3. Both JSONs have exactly 20 nodes, 22 edges, 5 categories
4. Zero dangling edge references (all source/target IDs reference valid nodes)
5. Zero orphan nodes (every node appears in at least one edge)
6. All node categories reference valid category IDs
7. Descriptions are practitioner-level (concrete numbers, formulas, actionable context)
8. Existing dividend-strategy.json remains valid against updated schema
</verification>

<success_criteria>
- Zod schema backward-compatible: existing dividend-strategy.json validates, new topics validate
- Both topic JSONs provide 40 curated financial concepts ready for explorer generation
- Content quality matches the dividend-strategy prototype's practitioner-level tone
- Schema change is minimal (one-line enum extension) with no side effects
</success_criteria>

<output>
After completion, create `.planning/phases/11-self-assessment-persistence-topics/11-01-SUMMARY.md`
</output>
