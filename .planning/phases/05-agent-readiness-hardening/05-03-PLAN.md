---
phase: 05-agent-readiness-hardening
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - pyproject.toml
  - src/models/dashboard_inputs.py
  - src/models/itc_risk_inputs.py
  - src/models/yaml_generation_inputs.py
  - src/analysis/correlation.py
  - src/analysis/itc_risk.py
  - src/analysis/options_chain_cli.py
  - src/ui/app.py
  - src/utils/screener.py
  - src/utils/moving_averages.py
  - src/utils/moving_averages_cli.py
  - src/utils/volatility.py
  - src/utils/input_validation.py
  - src/utils/yaml_generator_cli.py
  - src/strategies/backtester.py
  - src/ui/services/portfolio_loader.py
autonomous: true

must_haves:
  truths:
    - "Running uv run mypy src/ --ignore-missing-imports exits with zero errors"
    - "No existing tests regress after type fixes"
  artifacts:
    - path: "pyproject.toml"
      provides: "Type stub dev dependencies (types-PyYAML, types-requests)"
      contains: "types-PyYAML"
  key_links:
    - from: "pyproject.toml dev dependencies"
      to: "src/config.py and src/analysis/itc_risk.py"
      via: "type stubs resolve import-untyped errors"
      pattern: "types-PyYAML|types-requests"
---

<objective>
Fix all 50 mypy type errors across 16 source files so that `uv run mypy src/ --ignore-missing-imports` exits with zero errors.

Purpose: Zero mypy errors is the prerequisite for the pre-commit mypy hook (Plan 05-04) and establishes type safety across the codebase.
Output: All source files passing mypy strict checks. Type stub dependencies installed.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-agent-readiness-hardening/05-01-SUMMARY.md
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix type stubs, model decorators, annotation, and assignment errors</name>
  <files>
    pyproject.toml
    src/models/dashboard_inputs.py
    src/models/itc_risk_inputs.py
    src/models/yaml_generation_inputs.py
    src/analysis/correlation.py
    src/analysis/itc_risk.py
    src/analysis/options_chain_cli.py
    src/ui/app.py
  </files>
  <action>
  Run `uv run mypy src/ --ignore-missing-imports` to get the full error list. Then fix the following categories:

  **Category 1: import-untyped (2 errors)**
  - src/config.py line 14 and src/analysis/itc_risk.py line 34: Add type stubs as dev deps:
    ```bash
    uv add --dev types-PyYAML types-requests
    ```
  This modifies pyproject.toml and resolves both import-untyped errors without editing source files.

  **Category 2: prop-decorator (8 errors in dashboard_inputs.py)**
  - Lines 242-272, 388, 403: Pydantic's `@computed_field` stacked with `@property` is not supported by mypy. Fix by either:
    a. Removing the `@property` decorator (Pydantic v2 computed_field already acts as property), OR
    b. Adding `# type: ignore[prop-decorator]` if removing @property breaks Pydantic behavior

  **Category 4 partial: operator errors (1 error in itc_risk_inputs.py)**
  - itc_risk_inputs.py:291: None operand -- add None guard before arithmetic

  **Category 5: var-annotated (2 errors in correlation.py)**
  - Lines 156, 231: Add type annotation to dict comprehensions:
    ```python
    corr_dict: dict[str, dict[str, float]] = {}
    ```

  **Category 3 partial: arg-type (2 errors in options_chain_cli.py)**
  - Fix Literal type mismatches by adding explicit type annotations

  **Category 7: assignment (2 errors in ui/app.py)**
  - Lines 173, 194: Variable typed as None but assigned PortfolioSnapshotInput. Fix: declare with `Optional[PortfolioSnapshotInput] = None` or `PortfolioSnapshotInput | None = None`.

  After these fixes, run `uv run mypy src/ --ignore-missing-imports` to confirm remaining errors are only in Task 2 files.
  </action>
  <verify>
  - `uv run mypy src/models/ src/analysis/ src/ui/app.py --ignore-missing-imports` shows zero errors for these files
  - `uv run pytest -x -q` passes (no regressions)
  </verify>
  <done>Type stubs installed. Model decorator, annotation, and assignment errors resolved across 8 files. Mypy clean for these modules.</done>
</task>

<task type="auto">
  <name>Task 2: Fix Literal arg-type and call-arg errors across utils and strategies</name>
  <files>
    src/utils/screener.py
    src/utils/moving_averages.py
    src/utils/moving_averages_cli.py
    src/utils/volatility.py
    src/utils/input_validation.py
    src/utils/yaml_generator_cli.py
    src/strategies/backtester.py
    src/ui/services/portfolio_loader.py
  </files>
  <action>
  Fix the remaining mypy errors -- these are predominantly Literal type mismatches and call-arg issues:

  **Category 3: arg-type for Literal mismatches (16+ errors)**
  These occur when a plain `str` is passed where a `Literal[...]` type is expected. Fix each by casting or annotating:
  - screener.py (5 errors): Add Literal annotations where computed strings feed Pydantic models
  - moving_averages.py (3 errors): Annotate regime/signal variables with their Literal types
  - moving_averages_cli.py (1 error): Same pattern as moving_averages.py
  - volatility.py (1 error): Annotate volatility_regime with Literal type
  - input_validation.py (4 errors): Add Literal annotations for validation result strings
  - backtester.py (1 error): Annotate strategy result string
  - portfolio_loader.py (1 error): Annotate status/type string

  Pattern for all:
  ```python
  # Before (mypy error):
  regime = "high" if vol > threshold else "low"
  return VolatilityMetricsOutput(volatility_regime=regime)

  # After (fixed):
  regime: Literal["low", "normal", "high", "extreme"] = "high" if vol > threshold else "low"
  return VolatilityMetricsOutput(volatility_regime=regime)
  ```

  **Category 4 partial: operator errors (3 errors)**
  - moving_averages.py:474: None comparison -- add None guard
  - moving_averages_cli.py:162, 295: None operand -- add None guards

  **Category 6: call-arg errors (6 errors)**
  - screener.py lines 362, 398, 432, 461, 559: `prices` is not a valid kwarg for MomentumDataInput. Check the model definition and use the correct field name.
  - yaml_generator_cli.py:263: Missing required `mcp_json` arg -- add the missing argument.

  After all fixes, run: `uv run mypy src/ --ignore-missing-imports`
  Confirm: "Success: no issues found" or 0 errors.
  </action>
  <verify>
  - `uv run mypy src/ --ignore-missing-imports` exits with 0 errors
  - `uv run pytest -x -q` passes (no regressions from type fixes)
  </verify>
  <done>All 50 mypy errors resolved. `uv run mypy src/ --ignore-missing-imports` reports zero errors. All existing tests still pass.</done>
</task>

</tasks>

<verification>
1. `uv run mypy src/ --ignore-missing-imports` exits with zero errors
2. `uv run pytest -x -q` passes (no regressions)
3. Type stubs (types-PyYAML, types-requests) are in dev dependencies
</verification>

<success_criteria>
All 50 mypy errors resolved across 16 files. `uv run mypy src/ --ignore-missing-imports` reports zero errors. No test regressions.
</success_criteria>

<output>
After completion, create `.planning/phases/05-agent-readiness-hardening/05-03-SUMMARY.md`
</output>
