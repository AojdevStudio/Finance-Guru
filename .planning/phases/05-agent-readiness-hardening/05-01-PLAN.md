---
phase: 05-agent-readiness-hardening
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/analysis/correlation_cli.py
  - src/analysis/factors_cli.py
  - src/analysis/itc_risk_cli.py
  - src/analysis/risk_metrics_cli.py
  - src/strategies/backtester_cli.py
  - src/strategies/optimizer_cli.py
  - src/utils/data_validator_cli.py
  - src/utils/input_validation_cli.py
  - src/utils/momentum_cli.py
  - src/utils/moving_averages_cli.py
  - src/utils/screener_cli.py
  - src/utils/volatility_cli.py
  - src/utils/yaml_generator_cli.py
  - tests/python/test_env_setup.py
autonomous: true

must_haves:
  truths:
    - "Running ruff check src/ tests/ exits with zero errors"
    - "Ruff is configured as a dev dependency managed by uv"
  artifacts:
    - path: "pyproject.toml"
      provides: "Ruff configuration"
      contains: "[tool.ruff]"
    - path: "pyproject.toml"
      provides: "Ruff lint rules"
      contains: "[tool.ruff.lint]"
  key_links:
    - from: "pyproject.toml [tool.ruff.lint.per-file-ignores]"
      to: "src/**/*_cli.py E402 suppression"
      via: "per-file-ignores config"
      pattern: 'per-file-ignores'
---

<objective>
Configure ruff linter in pyproject.toml and fix all 84 lint errors across src/ and tests/ so that `ruff check src/ tests/` exits with zero errors.

Purpose: Success criterion 1 of Phase 5 -- clean linter output is the foundation for the pre-commit hook that will enforce lint on every commit.
Output: pyproject.toml with [tool.ruff] section, all source files passing lint.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ruff to dev dependencies and configure linter rules</name>
  <files>pyproject.toml</files>
  <action>
  1. Add ruff to dev dependency group: `uv add --dev ruff`

  2. Add [tool.ruff] section to pyproject.toml:
     ```toml
     [tool.ruff]
     target-version = "py312"
     line-length = 88
     exclude = [".venv", "notebooks", ".claude"]
     ```

  3. Add [tool.ruff.lint] section:
     ```toml
     [tool.ruff.lint]
     select = ["E", "F", "W", "I", "UP", "B"]
     ignore = ["E501"]
     ```

  4. Add per-file-ignores to suppress E402 in CLI scripts (they legitimately use sys.path.insert before imports):
     ```toml
     [tool.ruff.lint.per-file-ignores]
     "src/**/*_cli.py" = ["E402"]
     "src/analysis/factors_cli.py" = ["E402"]
     "tests/**" = ["E402"]
     ```

  IMPORTANT: Do NOT add ruff formatting config. Keep black as the formatter (already in dev deps). Ruff is linting ONLY.
  </action>
  <verify>Run `uv run ruff check --config pyproject.toml src/ tests/ 2>&1 | grep "E402"` and confirm zero E402 errors remain (all suppressed by per-file-ignores).</verify>
  <done>pyproject.toml contains [tool.ruff], [tool.ruff.lint], and [tool.ruff.lint.per-file-ignores] sections. Ruff is in dev dependencies. E402 errors are suppressed via per-file-ignores.</done>
</task>

<task type="auto">
  <name>Task 2: Fix all remaining ruff lint errors (F401, F541, F841, E741)</name>
  <files>
    src/analysis/correlation_cli.py
    src/analysis/itc_risk_cli.py
    src/strategies/backtester_cli.py
    src/strategies/optimizer_cli.py
    src/utils/data_validator_cli.py
    src/utils/momentum_cli.py
    src/utils/moving_averages_cli.py
    src/utils/screener_cli.py
    src/utils/volatility_cli.py
    src/utils/yaml_generator_cli.py
    tests/python/test_env_setup.py
  </files>
  <action>
  1. Run `uv run ruff check --fix src/ tests/` to auto-fix the 35 fixable errors:
     - F401 (31 unused imports): auto-removed by --fix
     - F541 (5 f-strings without placeholders): auto-fixed by --fix

  2. Manually fix F841 (5 unused variables) -- read each file, either:
     - Remove the unused variable assignment
     - Prefix with underscore if intentionally unused: `_unused = ...`
     - Replace with `_` if the value is needed for side effect only

  3. Manually fix E741 (1 ambiguous variable name) -- rename single-letter variable to a descriptive name (e.g., `l` -> `length` or `result_list`).

  4. Run `uv run ruff check src/ tests/` and confirm zero errors.

  5. Run `uv run pytest -x -q` to verify no tests broke from import removals.

  IMPORTANT: When removing unused imports (F401), verify the import is truly unused. Some imports might be re-exported or used in type hints.
  </action>
  <verify>
  Run both commands and confirm clean output:
  - `uv run ruff check src/ tests/` exits 0 with "All checks passed" or no output
  - `uv run pytest -x -q` shows all tests passing (0 failures)
  </verify>
  <done>All 84 ruff errors resolved: 42 E402 suppressed via per-file-ignores, 36 auto-fixed (F401 + F541), 5 F841 manually fixed, 1 E741 manually fixed. `ruff check src/ tests/` exits clean.</done>
</task>

</tasks>

<verification>
1. `uv run ruff check src/ tests/` exits with code 0 and zero errors
2. `uv run pytest -x -q` passes (no regressions from import removals)
3. pyproject.toml contains [tool.ruff], [tool.ruff.lint], and per-file-ignores sections
4. ruff is listed in [dependency-groups] dev
</verification>

<success_criteria>
Running `uv run ruff check src/ tests/` exits with zero errors. No test regressions.
</success_criteria>

<output>
After completion, create `.planning/phases/05-agent-readiness-hardening/05-01-SUMMARY.md`
</output>
