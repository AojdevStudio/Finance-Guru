---
phase: 08-rolling-tracker-hedge-sizer
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - fin-guru/data/hedging-strategies.md
  - fin-guru/data/options-insurance-framework.md
  - .claude/commands/fin-guru/agents/strategy-advisor.md
  - .claude/commands/fin-guru/agents/teaching-specialist.md
  - .claude/commands/fin-guru/agents/quant-analyst.md
autonomous: true

must_haves:
  truths:
    - "hedging-strategies.md covers protective puts, inverse ETFs, collar strategies, and position sizing in educational generic terms"
    - "options-insurance-framework.md explains options as insurance with put buying, premium budgeting, roll management, and the Black-Scholes American-style limitation"
    - "Strategy Advisor agent definition includes critical-action to load hedging-strategies.md"
    - "Teaching Specialist agent definition includes critical-action to load options-insurance-framework.md"
    - "Quant Analyst agent definition includes critical-action to load both knowledge files"
    - "All knowledge files contain educational-only content with no personal portfolio details"
  artifacts:
    - path: "fin-guru/data/hedging-strategies.md"
      provides: "Educational content on hedging strategies for agent context"
      contains: "protective put"
    - path: "fin-guru/data/options-insurance-framework.md"
      provides: "Educational content on options as insurance with BS limitation"
      contains: "intrinsic value floor"
    - path: ".claude/commands/fin-guru/agents/strategy-advisor.md"
      provides: "Updated agent with hedging knowledge reference"
      contains: "hedging-strategies.md"
    - path: ".claude/commands/fin-guru/agents/teaching-specialist.md"
      provides: "Updated agent with insurance framework reference"
      contains: "options-insurance-framework.md"
    - path: ".claude/commands/fin-guru/agents/quant-analyst.md"
      provides: "Updated agent with both knowledge file references"
      contains: "hedging-strategies.md"
  key_links:
    - from: ".claude/commands/fin-guru/agents/strategy-advisor.md"
      to: "fin-guru/data/hedging-strategies.md"
      via: "critical-action load instruction"
      pattern: "hedging-strategies\\.md"
    - from: ".claude/commands/fin-guru/agents/teaching-specialist.md"
      to: "fin-guru/data/options-insurance-framework.md"
      via: "critical-action load instruction"
      pattern: "options-insurance-framework\\.md"
    - from: ".claude/commands/fin-guru/agents/quant-analyst.md"
      to: "fin-guru/data/hedging-strategies.md"
      via: "critical-action load instruction"
      pattern: "hedging-strategies\\.md"
---

<objective>
Create educational knowledge base files for hedging strategies and options-as-insurance framework, and update three agent definitions to reference them.

Purpose: These knowledge files give the Strategy Advisor, Teaching Specialist, and Quant Analyst agents domain context about hedging concepts. The files are educational-only (no personal portfolio data) and provide the conceptual foundation that complements the Rolling Tracker and Hedge Sizer CLIs. The American-style options limitation (BS-01) is documented in the insurance framework.

Output:
- `fin-guru/data/hedging-strategies.md` -- educational hedging strategies
- `fin-guru/data/options-insurance-framework.md` -- options as insurance with BS limitation
- Updated agent definitions with knowledge file references
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-rolling-tracker-hedge-sizer/08-CONTEXT.md

# Agent definitions to update
@.claude/commands/fin-guru/agents/strategy-advisor.md
@.claude/commands/fin-guru/agents/teaching-specialist.md
@.claude/commands/fin-guru/agents/quant-analyst.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create knowledge base files in fin-guru/data/</name>
  <files>fin-guru/data/hedging-strategies.md, fin-guru/data/options-insurance-framework.md</files>
  <action>
Create the `fin-guru/data/` directory if it does not exist.

**Create `fin-guru/data/hedging-strategies.md`:**

Content should be educational, generic (no personal portfolio details), and structured for agent context loading. Include:

1. **Header:** "# Hedging Strategies Reference" with note "Educational reference for Finance Guru agents. NOT investment advice."
2. **Protective Puts:**
   - What they are (buying put options as portfolio insurance)
   - When to use (downside protection during uncertain markets)
   - Key parameters: strike selection (OTM %), DTE, sizing
   - Typical configurations: 10-20% OTM, 30-90 DTE
   - Rolling strategy: close before expiry, open new position
3. **Inverse ETFs (SQQQ, SH, SPXU):**
   - What they are (daily-rebalanced leveraged short exposure)
   - Volatility decay / daily compounding drag
   - When they work well (short-term hedges, strong conviction)
   - When they fail (sideways or V-shaped markets)
4. **Collar Strategies:**
   - Buy protective put + sell covered call
   - Zero-cost collar concept
   - Tradeoffs (caps upside to fund downside protection)
5. **Position Sizing:**
   - 1 contract per $50k portfolio value as baseline
   - Adjusting by conviction and market regime
   - Budget discipline: monthly allocation approach
6. **Roll Management:**
   - Why rolling matters (theta decay accelerates near expiry)
   - Roll window: 5-7 days before expiry
   - Selecting replacements: balance cost per day, DTE, strike
7. **CLI Tools:**
   - Reference `rolling_tracker_cli.py` for position monitoring
   - Reference `hedge_sizer_cli.py` for contract sizing
   - Reference `hedge_comparison_cli.py` (Phase 9) for strategy comparison

**Create `fin-guru/data/options-insurance-framework.md`:**

Content should explain options through the lens of insurance. Include:

1. **Header:** "# Options as Insurance Framework" with educational disclaimer
2. **The Insurance Analogy:**
   - Premium = insurance premium (cost of protection)
   - Strike = deductible (how much loss you absorb)
   - Expiry = policy term (when coverage ends)
   - Contract size = coverage amount (100 shares per contract)
3. **Put Buying for Protection:**
   - Buying puts = buying insurance policies
   - Higher OTM = higher deductible = cheaper premium
   - Longer DTE = longer term = more expensive
   - Sizing = how many policies for your portfolio
4. **Premium Budgeting:**
   - Monthly budget approach (treat as recurring expense)
   - Cost as percentage of portfolio (typical 0.5-2% annually)
   - Budget tracking with the hedge sizer tool
5. **Roll Management:**
   - Renewing your insurance before it expires
   - Why: theta decay accelerates in last 7 days
   - Fixed 7-day roll window
   - Use rolling tracker to monitor DTE and get alerts
6. **Black-Scholes Limitation on American-Style Options (BS-01):**
   - BS model assumes European-style (exercise only at expiry)
   - US equity options are American-style (exercise anytime)
   - American puts are worth at LEAST intrinsic value: max(strike - spot, 0)
   - Finance Guru applies intrinsic value floor: `american_price = max(bs_price, intrinsic_value)`
   - This matters most for deep ITM puts where BS may undervalue
   - Disclaimer: This is an approximation. True American option pricing requires binomial trees or numerical methods.
7. **Risk Warnings:**
   - Options can expire worthless (100% loss of premium)
   - Past protection performance doesn't predict future
   - Professional consultation recommended

Both files should be 200-400 lines. Use markdown headers, bullet points, and occasional code-block examples showing CLI usage. Do NOT include personal names, account numbers, or specific portfolio holdings.
  </action>
  <verify>
```bash
# Verify files exist
ls -la fin-guru/data/hedging-strategies.md fin-guru/data/options-insurance-framework.md

# Verify content is educational (no PII)
grep -iE "account|brokerage|Z057|net.worth|LLC|ossie" fin-guru/data/hedging-strategies.md fin-guru/data/options-insurance-framework.md && echo "PII FOUND - FIX THIS" || echo "No PII found - OK"

# Verify key content
grep -c "protective put" fin-guru/data/hedging-strategies.md
grep -c "intrinsic value" fin-guru/data/options-insurance-framework.md
grep -c "Black-Scholes" fin-guru/data/options-insurance-framework.md

# Verify non-trivial content
wc -l fin-guru/data/hedging-strategies.md fin-guru/data/options-insurance-framework.md
```
  </verify>
  <done>Two knowledge base files exist in fin-guru/data/ with educational content covering hedging strategies, options-as-insurance, and BS-01 American-style limitation. No PII. Both files are 200+ lines.</done>
</task>

<task type="auto">
  <name>Task 2: Update three agent definitions to reference knowledge files</name>
  <files>.claude/commands/fin-guru/agents/strategy-advisor.md, .claude/commands/fin-guru/agents/teaching-specialist.md, .claude/commands/fin-guru/agents/quant-analyst.md</files>
  <action>
Add critical-action instructions to load the new knowledge base files in each agent definition.

**Strategy Advisor (.claude/commands/fin-guru/agents/strategy-advisor.md):**

Read the existing file. In the `<critical-actions>` block, add TWO new instructions AFTER the existing Load instructions (after the line loading `cashflow-policy.md`):

```xml
  <i>Load COMPLETE file {project-root}/fin-guru/data/hedging-strategies.md for hedge strategy evaluation and roll management</i>
  <i>Load COMPLETE file {project-root}/fin-guru/data/options-insurance-framework.md for options insurance analysis</i>
```

Also add a new tool reference instruction after the existing validation tools line:
```xml
  <i>üõ°Ô∏è HEDGING TOOLS: Use rolling_tracker_cli.py for position monitoring, hedge_sizer_cli.py for contract sizing</i>
```

**Teaching Specialist (.claude/commands/fin-guru/agents/teaching-specialist.md):**

Read the existing file. In the `<critical-actions>` block, add ONE new instruction AFTER the existing Load instruction (after `system-context.md`):

```xml
  <i>Load COMPLETE file {project-root}/fin-guru/data/options-insurance-framework.md for teaching options hedging concepts</i>
  <i>Load COMPLETE file {project-root}/fin-guru/data/hedging-strategies.md for hedging strategy education</i>
```

**Quant Analyst (.claude/commands/fin-guru/agents/quant-analyst.md):**

Read the existing file. In the `<critical-actions>` block, add TWO new instructions AFTER the existing Load instructions (after `risk-framework.md`):

```xml
  <i>Load COMPLETE file {project-root}/fin-guru/data/hedging-strategies.md for quantitative hedge analysis</i>
  <i>Load COMPLETE file {project-root}/fin-guru/data/options-insurance-framework.md for options pricing context including BS limitations</i>
```

Also add a new tool reference instruction after the existing optimizer line:
```xml
  <i>üõ°Ô∏è HEDGING ANALYSIS: Use rolling_tracker_cli.py for position status, hedge_sizer_cli.py for sizing analysis</i>
```

**IMPORTANT:**
- Read each file FULLY before modifying
- Only ADD lines, do NOT remove or modify existing content
- Follow the exact XML tag pattern used in the existing instructions
- Preserve all existing whitespace and formatting
- The `{project-root}` variable is used as-is (not a Python format string)
  </action>
  <verify>
```bash
# Verify Strategy Advisor has hedging references
grep "hedging-strategies.md" .claude/commands/fin-guru/agents/strategy-advisor.md
grep "options-insurance-framework.md" .claude/commands/fin-guru/agents/strategy-advisor.md

# Verify Teaching Specialist has insurance framework reference
grep "options-insurance-framework.md" .claude/commands/fin-guru/agents/teaching-specialist.md
grep "hedging-strategies.md" .claude/commands/fin-guru/agents/teaching-specialist.md

# Verify Quant Analyst has both references
grep "hedging-strategies.md" .claude/commands/fin-guru/agents/quant-analyst.md
grep "options-insurance-framework.md" .claude/commands/fin-guru/agents/quant-analyst.md

# Verify existing content not removed (spot check)
grep "system-context.md" .claude/commands/fin-guru/agents/strategy-advisor.md
grep "risk-framework.md" .claude/commands/fin-guru/agents/quant-analyst.md
```
  </verify>
  <done>Three agent definitions updated with knowledge file references. Strategy Advisor loads both files + hedging tools. Teaching Specialist loads both files. Quant Analyst loads both files + hedging tools. No existing content removed. HEDG-10 complete.</done>
</task>

</tasks>

<verification>
Full integration check:

```bash
# 1. Knowledge base files exist and have content
for f in fin-guru/data/hedging-strategies.md fin-guru/data/options-insurance-framework.md; do
    test -f "$f" && echo "$f: EXISTS" || echo "$f: MISSING"
    wc -l "$f" 2>/dev/null
done

# 2. No PII in knowledge files
grep -rliE "account|brokerage|Z057|net.worth|LLC|ossie|irondi" fin-guru/data/hedging-strategies.md fin-guru/data/options-insurance-framework.md && echo "PII FOUND" || echo "No PII - OK"

# 3. All three agents reference knowledge files
for agent in strategy-advisor teaching-specialist quant-analyst; do
    count=$(grep -c "hedging-strategies\|options-insurance-framework" .claude/commands/fin-guru/agents/$agent.md)
    echo "$agent: $count knowledge file references"
done

# 4. BS-01 documented
grep -c "intrinsic value" fin-guru/data/options-insurance-framework.md
```
</verification>

<success_criteria>
1. `fin-guru/data/hedging-strategies.md` exists with educational hedging content (HEDG-09)
2. `fin-guru/data/options-insurance-framework.md` exists with insurance framework and BS-01 limitation (HEDG-09, BS-01)
3. Strategy Advisor agent references both knowledge files (HEDG-10)
4. Teaching Specialist agent references both knowledge files (HEDG-10)
5. Quant Analyst agent references both knowledge files (HEDG-10)
6. No personal portfolio details in knowledge files (educational-only)
7. Black-Scholes American-style limitation documented with intrinsic value floor explanation (BS-01)
</success_criteria>

<output>
After completion, create `.planning/phases/08-rolling-tracker-hedge-sizer/08-05-SUMMARY.md`
</output>
