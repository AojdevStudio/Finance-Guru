---
phase: 12-maya-integration-polish-cli
plan: 03
type: execute
wave: 2
depends_on: ["12-01", "12-02"]
files_modified:
  - src/explorer/dist/dividend-strategy-explorer.html
  - src/explorer/dist/options-greeks-explorer.html
  - src/explorer/dist/risk-management-explorer.html
autonomous: false

must_haves:
  truths:
    - "All 3 explorers are rebuilt with the Export Profile button from Plan 12-01"
    - "Clicking Export Profile in any explorer downloads learner-profile.json with the correct Maya schema"
    - "Topic selector landing page at src/explorer/landing/index.html shows all 3 explorers as cards"
    - "Running `uv run python src/cli/fin_guru.py explore dividend-strategy` opens the explorer in the default browser"
    - "Maya agent definition references learner-profile.json in its activation sequence"
    - "All Python tests pass: `uv run pytest tests/python/test_explore_cli.py`"
  artifacts:
    - path: "src/explorer/dist/dividend-strategy-explorer.html"
      provides: "Rebuilt dividend explorer with Export Profile feature"
      contains: "export-profile-btn, learner_profile"
    - path: "src/explorer/dist/options-greeks-explorer.html"
      provides: "Rebuilt options greeks explorer with Export Profile feature"
      contains: "export-profile-btn, learner_profile"
    - path: "src/explorer/dist/risk-management-explorer.html"
      provides: "Rebuilt risk management explorer with Export Profile feature"
      contains: "export-profile-btn, learner_profile"
  key_links:
    - from: "src/explorer/dist/*-explorer.html"
      to: "fin-guru/data/learner-profile.json"
      via: "Export Profile button downloads JSON"
      pattern: "exportLearnerProfile.*learner_profile"
    - from: "src/cli/fin_guru.py"
      to: "src/explorer/dist/*-explorer.html"
      via: "webbrowser.open() with file:// URL"
      pattern: "webbrowser\\.open"
    - from: ".claude/commands/fin-guru/agents/teaching-specialist.md"
      to: "fin-guru/data/learner-profile.json"
      via: "Activation step reads profile"
      pattern: "learner-profile\\.json"
---

<objective>
Rebuild all explorers with Phase 12 enhancements, run all tests, and verify the complete integration chain: explorer -> export -> Maya reads profile, and CLI -> browser.

Purpose: End-to-end verification that Phase 12 delivers on all 4 success criteria. This is the final phase on feat/m3-explorer -- everything must work before the merge PR.
Output: 3 rebuilt explorer HTML files + verified integration + human sign-off.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-maya-integration-polish-cli/12-01-SUMMARY.md
@.planning/phases/12-maya-integration-polish-cli/12-02-SUMMARY.md

Plan 12-01 SUMMARY provides: Explorer template enhanced with Export Profile button + Maya agent updated
Plan 12-02 SUMMARY provides: Landing page created + CLI explore subcommand added + tests written
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild all explorers and run verification suite</name>
  <files>
    src/explorer/dist/dividend-strategy-explorer.html
    src/explorer/dist/options-greeks-explorer.html
    src/explorer/dist/risk-management-explorer.html
  </files>
  <action>
Rebuild all 3 knowledge explorers using the enhanced template from Plan 12-01, then run the full verification suite.

**Step 1: Rebuild all explorers:**

```bash
cd /Users/ossieirondi/Documents/Irondi-Household/family-office

# Rebuild dividend explorer
bun run src/explorer/build.ts src/explorer/topics/dividend-strategy.json

# Rebuild options-greeks explorer
bun run src/explorer/build.ts src/explorer/topics/options-greeks.json

# Rebuild risk-management explorer
bun run src/explorer/build.ts src/explorer/topics/risk-management.json
```

**Step 2: Verify all outputs exist and are standalone:**

```bash
# Check files exist
ls -la src/explorer/dist/*.html

# Verify each is standalone (no external script/link references)
for f in src/explorer/dist/*.html; do
  echo "=== $(basename $f) ==="
  echo "Size: $(wc -c < $f) bytes"
  ext_scripts=$(grep -c '<script src=' "$f" 2>/dev/null || echo 0)
  ext_links=$(grep -c '<link.*href=.*\.css' "$f" 2>/dev/null || echo 0)
  echo "External scripts: $ext_scripts, External CSS: $ext_links"
done
```

**Step 3: Verify Export Profile feature is present in all built explorers:**

```bash
for f in src/explorer/dist/*.html; do
  echo "=== $(basename $f) ==="
  # Export Profile button
  grep -c 'export-profile-btn' "$f"
  # learner_profile schema
  grep -c 'learner_profile' "$f"
  # buildLearnerProfile function
  grep -c 'buildLearnerProfile\|exportLearnerProfile' "$f"
  # Maya integration section
  grep -c 'maya_integration' "$f"
done
```

**Step 4: Verify Phase 11 features still present (no regression):**

```bash
for f in src/explorer/dist/*.html; do
  echo "=== $(basename $f) ==="
  has_storage=$(grep -c "localStorage" "$f")
  has_modes=$(grep -c "mode-selector" "$f")
  has_clipboard=$(grep -c "clipboard" "$f")
  has_responsive=$(grep -c "max-width.*768px" "$f")
  echo "localStorage=$has_storage, modes=$has_modes, clipboard=$has_clipboard, responsive=$has_responsive"
done
```

**Step 5: Verify landing page exists and links are correct:**

```bash
# Landing page exists
test -f src/explorer/landing/index.html && echo "Landing: OK" || echo "Landing: MISSING"
test -f src/explorer/landing/styles.css && echo "Styles: OK" || echo "Styles: MISSING"

# Landing page references all 3 explorers
grep -c 'dividend-strategy-explorer.html' src/explorer/landing/index.html
grep -c 'options-greeks-explorer.html' src/explorer/landing/index.html
grep -c 'risk-management-explorer.html' src/explorer/landing/index.html
```

**Step 6: Run Python tests:**

```bash
cd /Users/ossieirondi/Documents/Irondi-Household/family-office
uv run pytest tests/python/test_explore_cli.py -v
```

**Step 7: Verify CLI explore command works:**

```bash
# --list should show all topics
uv run python src/cli/fin_guru.py explore --list

# --help should show explore subcommand
uv run python src/cli/fin_guru.py explore --help
```

**Step 8: Verify Maya agent definition:**

```bash
# teaching-specialist.md mentions learner-profile.json
grep -c 'learner-profile.json' .claude/commands/fin-guru/agents/teaching-specialist.md

# build-learner-profile.md mentions explorer export
grep -c 'explorer' fin-guru/tasks/build-learner-profile.md
```

If any build fails, diagnose from error messages and fix before proceeding.
If tests fail, fix and re-run until green.
  </action>
  <verify>
```bash
cd /Users/ossieirondi/Documents/Irondi-Household/family-office

# All 3 explorers built
test -f src/explorer/dist/dividend-strategy-explorer.html && echo "dividend: OK" || echo "dividend: MISSING"
test -f src/explorer/dist/options-greeks-explorer.html && echo "options-greeks: OK" || echo "options-greeks: MISSING"
test -f src/explorer/dist/risk-management-explorer.html && echo "risk-management: OK" || echo "risk-management: MISSING"

# Export Profile feature in all explorers
for f in src/explorer/dist/*.html; do
  has_export=$(grep -c 'export-profile-btn' "$f")
  has_profile=$(grep -c 'learner_profile' "$f")
  echo "$(basename $f): export-btn=$has_export, learner_profile=$has_profile"
done

# Landing page exists
test -f src/explorer/landing/index.html && echo "Landing: OK" || echo "Landing: MISSING"

# Tests pass
uv run pytest tests/python/test_explore_cli.py -v 2>&1 | tail -5

# CLI works
uv run python src/cli/fin_guru.py explore --list 2>&1 | head -10

# Maya references profile
grep -c 'learner-profile.json' .claude/commands/fin-guru/agents/teaching-specialist.md
```
  </verify>
  <done>
- All 3 explorers rebuilt with Export Profile feature
- All explorers standalone (zero external dependencies)
- Phase 11 features preserved (localStorage, learning modes, clipboard, responsive)
- Landing page exists with links to all 3 explorers
- Python tests pass
- CLI explore --list shows all topics
- Maya agent references learner-profile.json
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 12 integration: Maya learner profile export, topic selector landing page, CLI launcher, and Maya agent updates.

Features to verify:
1. Export Profile button in explorers downloads Maya-compatible JSON
2. Topic selector landing page shows 3 explorer cards
3. CLI `explore` command opens explorers in browser
4. Maya agent definition references learner profile
  </what-built>
  <how-to-verify>
1. **Test Export Profile in explorer:**
   ```bash
   open src/explorer/dist/dividend-strategy-explorer.html
   ```
   - Click a few concept nodes to set knowledge states (e.g., some mastered, some unknown)
   - Click "Export Profile" button
   - A file named `learner-profile.json` should download
   - Open the downloaded file and verify it contains:
     - `learner_profile.topic` = "dividend-strategy"
     - `learner_profile.assessed_at` = ISO timestamp
     - `learner_profile.knowledge_state` with 4 arrays (unknown, familiar, confident, mastered)
     - `learner_profile.learning_mode_preference` = current mode
     - `learner_profile.maya_integration.skip_concepts` = mastered+confident IDs
     - `learner_profile.maya_integration.start_with` = first familiar or unknown concept

2. **Test topic selector landing page:**
   ```bash
   open src/explorer/landing/index.html
   ```
   - Verify 3 cards appear: Dividend Strategy, Options Greeks, Risk Management
   - Each card shows topic description and concept count
   - Cards show "New" badge or assessment percentage
   - Click a card to verify it navigates to the correct explorer
   - Resize browser window to verify responsive layout

3. **Test CLI explore command:**
   ```bash
   uv run python src/cli/fin_guru.py explore dividend-strategy
   ```
   - Verify the dividend explorer opens in the default browser
   ```bash
   uv run python src/cli/fin_guru.py explore --list
   ```
   - Verify all 3 topics are listed with build status
   ```bash
   uv run python src/cli/fin_guru.py explore nonexistent 2>&1
   ```
   - Verify error message shows available topics

4. **Verify Maya integration (code review):**
   - Open `.claude/commands/fin-guru/agents/teaching-specialist.md`
   - Confirm activation includes step checking for learner-profile.json
   - Confirm explorer-integration section exists

5. **Copy learner-profile.json to fin-guru/data/ and verify Maya reads it:**
   - Copy the downloaded learner-profile.json to `fin-guru/data/learner-profile.json`
   - This simulates what users would do after exporting
   - Verify the file is valid JSON with `python3 -m json.tool fin-guru/data/learner-profile.json`

6. **Phase 12 success criteria check:**
   - [SC-1] Clicking "Export Profile" downloads JSON matching Maya's learner_profile schema
   - [SC-2] `uv run python src/cli/fin_guru.py explore dividend-strategy` opens explorer in browser
   - [SC-3] Maya agent reads exported learner profile at session start (if file exists)
   - [SC-4] Topic selector landing page shows all available explorers as card grid with completion badges
  </how-to-verify>
  <resume-signal>Type "approved" if all Phase 12 features work correctly, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
Phase 12 success criteria verification:
1. [SC-1] Export Profile downloads JSON matching Maya's learner_profile schema -- verified by human in checkpoint (open JSON, check structure)
2. [SC-2] CLI explore command opens explorer in browser -- verified by human in checkpoint
3. [SC-3] Maya agent reads learner profile at session start -- verified by code review of teaching-specialist.md
4. [SC-4] Topic selector landing page shows card grid with completion badges -- verified by human in checkpoint

Cross-cutting:
- XC-02 (file-based integration): Explorer exports JSON, Maya reads JSON -- no cross-language imports
- XC-04 (tests): test_explore_cli.py covers CLI subcommand with 10+ tests
</verification>

<success_criteria>
- All 4 Phase 12 success criteria from ROADMAP.md are satisfied
- All explorers rebuilt with Export Profile feature
- Python tests pass
- Human verifies export, landing page, CLI, and Maya integration
- Phase 12 is the final phase on feat/m3-explorer -- ready for merge PR to main
</success_criteria>

<output>
After completion, create `.planning/phases/12-maya-integration-polish-cli/12-03-SUMMARY.md`
</output>
