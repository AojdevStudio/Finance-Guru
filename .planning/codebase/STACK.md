# Technology Stack
> Auto-generated by codebase mapper

## Overview
Finance Guru™ is a polyglot financial analysis system built on Python 3.12+ for backend analysis and TypeScript/Bun for frontend infrastructure. The codebase implements a 3-layer architecture (Pydantic Models → Calculator Classes → CLI/UI) for financial analysis tools, with a Plaid integration dashboard built on Next.js, React 19, and a Postgres + Drizzle ORM backend.

## Language Runtimes

| Runtime | Version | Usage | Config File |
|---------|---------|-------|-------------|
| **Python** | 3.12+ | Core financial analysis, CLI tools, data processing | `pyproject.toml` |
| **TypeScript** | 5.7+ | Dashboard frontend, backend services, database schema | `tsconfig.json` |
| **JavaScript/Node.js** | ESNext | Tooling, package management | `package.json` |
| **Bun** | 1.1.0 | JavaScript runtime for Plaid dashboard monorepo | `package.json` (apps/plaid-dashboard) |

## Package Managers

| Manager | Primary Use | Config Files |
|---------|------------|--------------|
| **uv** | Python dependency management | `pyproject.toml`, `uv.lock` |
| **Bun** | JavaScript package management (monorepo) | `bun.lock`, `package.json` |
| **npm** | Hook scripts and CLI tools | `.claude/hooks/package.json` |

## Python Dependencies

### Core Dependencies (`pyproject.toml`)

**Financial Analysis & Data**
- `yfinance>=0.2.66` — Market data fetching (free, end-of-day and real-time)
- `pandas>=2.3.2` — Data manipulation and time series analysis
- `numpy>=2.3.3` — Numerical computations
- `scipy>=1.16.2` — Statistical functions (VaR, distribution fitting)
- `scikit-learn>=1.7.2` — Machine learning for factor analysis and optimization

**UI & Visualization**
- `streamlit>=1.50.0` — Dashboard framework (optional, not currently active)
- `plotly>=6.3.0` — Interactive charting
- `matplotlib>=3.10.8` — Static visualization
- `textual>=6.6.0` — Terminal UI framework

**Data Formats & Serialization**
- `pydantic>=2.10.6` — Data validation and serialization (core to 3-layer architecture)
- `pyyaml>=6.0.3` — YAML configuration parsing
- `openpyxl>=3.1.5` — Excel file reading
- `xlsxwriter>=3.2.9` — Excel file writing
- `beautifulsoup4>=4.13.5` — HTML parsing

**Reporting & Output**
- `reportlab>=4.4.5` — PDF report generation

**API & Environment**
- `requests>=2.32.5` — HTTP requests for API integration
- `urllib3>=2.6.3` — HTTP client library (dependency)
- `python-dotenv>=1.1.1` — Environment variable management

### Development Dependencies

```toml
[dependency-groups]
dev = [
    "black>=24.10.0",        # Code formatting
    "mypy>=1.13.0",          # Type checking
    "pytest>=9.0.2",         # Testing framework
    "pytest-cov>=7.0.0",     # Coverage reporting
]
```

**Test Configuration** (`pyproject.toml`)
- Test directory: `tests/python/`
- Test marker for integration tests: `@pytest.mark.integration`
- Python path: `.` (project root)

## TypeScript/JavaScript Dependencies

### Root Project (`package.json`)
```json
{
  "name": "family-office",
  "type": "module",
  "devDependencies": {
    "@types/bun": "latest",
    "typescript": "^5"
  }
}
```

### Plaid Dashboard Monorepo

**Workspace Structure** (located at `apps/plaid-dashboard/`)
- **Root workspace manager**: `turbo@^2.3.0` (Turborepo monorepo orchestration)
- **Build system**: Bun (`bun@1.1.0` package manager)
- **Workspaces**: dashboard, engine, db

#### Dashboard (`apps/plaid-dashboard/dashboard/`)
- **Framework**: Next.js 15.0.0 (App Router, React Server Components)
- **UI Library**: React 19.0.0
- **Styling**: Tailwind CSS 3.4.0, PostCSS 8.4.0, Autoprefixer 10.4.0
- **Components**: Lucide React 0.460.0 (icons), clsx 2.1.0, tailwind-merge 2.5.0
- **Data Fetching**: @tanstack/react-query 5.60.0 (React Query)
- **Plaid Integration**: react-plaid-link 3.6.0
- **Dev Tools**: TypeScript 5.7.0, @types/node 22.0.0, @types/react 19.0.0, @types/react-dom 19.0.0

#### Backend Engine (`apps/plaid-dashboard/engine/`)
- **Framework**: Hono 4.6.0 (Lightweight web framework for Bun/Node.js)
- **Server**: @hono/node-server 1.13.0
- **Validation**: @hono/zod-validator 0.7.6, Zod 3.23.0
- **Database ORM**: drizzle-orm 0.38.0
- **Database Client**: postgres 3.4.5 (Postgres.js)
- **Environment**: dotenv 16.4.0

#### Database Schema (`apps/plaid-dashboard/db/`)
- **ORM**: drizzle-orm 0.38.0
- **Migrations**: drizzle-kit 0.30.0
- **Database**: PostgreSQL (via postgres.js 3.4.5)
- **Database Studio**: drizzle-kit studio (interactive UI)

### TypeScript Configuration (`tsconfig.json`)

```json
{
  "compilerOptions": {
    "lib": ["ESNext"],
    "target": "ESNext",
    "module": "Preserve",
    "moduleDetection": "force",
    "jsx": "react-jsx",
    "moduleResolution": "bundler",
    "strict": true,
    "skipLibCheck": true
  }
}
```

## Build Tools & Tooling

### Python Build & Development

| Tool | Version | Purpose | Config |
|------|---------|---------|--------|
| **Black** | 24.10.0+ | Code formatting | `pyproject.toml` (implicit) |
| **MyPy** | 1.13.0+ | Type checking | `pyproject.toml` (implicit) |
| **Pytest** | 9.0.2+ | Unit/integration testing | `pyproject.toml` (testpaths, markers) |
| **pytest-cov** | 7.0.0+ | Coverage reporting | `pyproject.toml` (addopts) |

### JavaScript Build & Development

| Tool | Version | Purpose | Location |
|------|---------|---------|----------|
| **Turbo** | 2.3.0 | Monorepo task orchestration | `apps/plaid-dashboard/turbo.json` |
| **Next.js** | 15.0.0 | React framework (build, dev server) | `apps/plaid-dashboard/dashboard/next.config.ts` |
| **TypeScript** | 5.7.0 | Type checking | `tsconfig.json` (root & workspace-specific) |
| **Tailwind CLI** | 3.4.0 | CSS generation | `apps/plaid-dashboard/dashboard/tailwind.config.ts` |
| **Drizzle Kit** | 0.30.0 | Database schema migrations | `apps/plaid-dashboard/db/drizzle.config.ts` |

## Configuration Files

### Python Configuration

| File | Purpose | Location |
|------|---------|----------|
| `pyproject.toml` | Project metadata, dependencies, tool config | `/` |
| `uv.lock` | Locked dependency versions (reproducible builds) | `/` |
| `.env.example` | Environment variable template | `/` |
| `.env` | Actual environment variables (not committed) | `/` |
| `.pytest_cache/` | Pytest cache | `/` |
| `.ruff_cache/` | Ruff formatter cache | `/` |

### TypeScript/JavaScript Configuration

| File | Purpose | Location |
|------|---------|----------|
| `tsconfig.json` | Root TypeScript configuration (ESNext target) | `/` |
| `package.json` | Root package definition (monorepo) | `/` |
| `bun.lock` | Bun lock file (reproducible installs) | `/` |
| `apps/plaid-dashboard/tsconfig.json` | Workspace-specific TS config | Workspace root |
| `apps/plaid-dashboard/dashboard/tsconfig.json` | Dashboard-specific TS config | Dashboard |
| `apps/plaid-dashboard/dashboard/next.config.ts` | Next.js build configuration | Dashboard |
| `apps/plaid-dashboard/dashboard/tailwind.config.ts` | Tailwind CSS configuration | Dashboard |
| `apps/plaid-dashboard/db/drizzle.config.ts` | Database migration configuration | Database workspace |

### Framework Configuration

| File | Purpose | Location |
|------|---------|----------|
| `.mcp.json` | MCP Server definitions (Anthropic Claude) | `/` |
| `fin-guru/config.yaml` | Finance Guru system configuration | `fin-guru/` |
| `fin-guru/framework/*.yaml` | Framework directives, tools, routing | `fin-guru/framework/` |
| `.github/workflows/*.yml` | GitHub Actions CI/CD | `.github/workflows/` |
| `.vscode/settings.json` | VS Code workspace settings | `.vscode/` |
| `.claude/settings.json` | Claude Code configuration | `.claude/` |

## Source Code Organization

### Python Architecture (3-Layer Pattern)

```
src/
├── models/                 # Layer 1: Pydantic data models
│   ├── __init__.py
│   ├── risk_inputs.py      # VaR, Sharpe, Sortino, Max DD, etc.
│   ├── momentum_inputs.py  # RSI, MACD, Williams %R, ROC
│   ├── volatility_inputs.py
│   ├── correlation_inputs.py
│   ├── backtest_inputs.py
│   ├── moving_avg_inputs.py
│   ├── portfolio_inputs.py
│   ├── itc_risk_inputs.py  # ITC Risk API models
│   ├── options_inputs.py   # Options chain models
│   ├── factors_inputs.py
│   ├── screener_inputs.py
│   ├── yaml_generation_inputs.py
│   ├── validation_inputs.py
│   └── dashboard_inputs.py
│
├── analysis/               # Layer 2: Calculator classes
│   ├── risk_metrics.py     # RiskCalculator
│   ├── risk_metrics_cli.py # Layer 3: CLI
│   ├── correlation.py      # CorrelationCalculator
│   ├── correlation_cli.py
│   ├── itc_risk.py         # ITCRiskCalculator (API client)
│   ├── itc_risk_cli.py
│   ├── options.py          # OptionsCalculator
│   ├── options_cli.py
│   ├── options_chain_cli.py # Live options chains from yfinance
│   ├── factors.py          # FactorsCalculator
│   └── factors_cli.py
│
├── strategies/             # Layer 2: Strategy calculators
│   ├── backtester.py       # BacktestEngine
│   ├── backtester_cli.py
│   ├── optimizer.py        # PortfolioOptimizer
│   └── optimizer_cli.py
│
├── utils/                  # Layer 2: Utility calculators
│   ├── market_data.py      # get_prices(), market data fetching
│   ├── momentum.py         # MomentumCalculator
│   ├── momentum_cli.py
│   ├── volatility.py       # VolatilityCalculator
│   ├── volatility_cli.py
│   ├── moving_averages.py  # MovingAverageCalculator
│   ├── moving_averages_cli.py
│   ├── screener.py         # ScreenerCalculator
│   ├── screener_cli.py
│   ├── data_validator.py   # DataValidator
│   ├── data_validator_cli.py
│   ├── input_validation.py # InputValidator
│   ├── input_validation_cli.py
│   ├── yaml_generator.py   # YAMLGenerator
│   ├── yaml_generator_cli.py
│   └── progress_persistence.py
│
├── ui/                     # Streamlit dashboard (separate from 3-layer)
│   ├── app.py              # Main Streamlit app
│   ├── services/
│   │   ├── portfolio_loader.py
│   │   └── analysis_runner.py
│   └── widgets/
│       ├── portfolio_header.py
│       ├── ticker_input.py
│       └── results_panel.py
│
├── cli/                    # CLI entry points
│   └── fin_guru.py
│
├── data/                   # Data utilities
│   └── (market data cache)
│
├── reports/                # Report generation
│   └── (report output)
│
├── CLAUDE.md               # Developer guide for src/ architecture
├── config.py               # FinGuruConfig: paths, layer configuration
└── __init__.py
```

### TypeScript/JavaScript Architecture

```
apps/plaid-dashboard/
├── package.json            # Workspace root (Turbo monorepo)
├── turbo.json              # Turbo configuration
├── dashboard/              # Next.js frontend
│   ├── package.json
│   ├── tsconfig.json
│   ├── next.config.ts
│   ├── tailwind.config.ts
│   ├── src/
│   │   ├── app/             # Next.js app directory
│   │   ├── components/      # React components
│   │   ├── lib/             # Utilities, API clients
│   │   └── styles/          # Global styles
│   └── public/              # Static assets
│
├── engine/                 # Hono backend API
│   ├── package.json
│   ├── tsconfig.json
│   ├── src/
│   │   ├── index.ts         # Main server entry
│   │   ├── routes/          # Route handlers
│   │   ├── middleware/      # Auth, validation
│   │   ├── services/        # Business logic
│   │   └── types/           # TypeScript types
│   └── dist/                # Compiled output
│
└── db/                     # Database schema & migrations
    ├── package.json
    ├── tsconfig.json
    ├── drizzle.config.ts
    ├── src/
    │   ├── schema.ts        # Drizzle schema (bank_connections, accounts, etc.)
    │   ├── client.ts        # Postgres connection
    │   └── index.ts         # Exports
    └── migrations/          # Database migrations
```

## CI/CD & Automation

| System | Config File | Purpose |
|--------|------------|---------|
| **GitHub Actions** | `.github/workflows/claude.yml` | Claude Code integration for PR review |
| **Claude Code** | `.claude/settings.json` | Claude CLI configuration |

## Data Formats

| Format | Usage | Examples |
|--------|-------|----------|
| **YAML** | Configuration, framework definitions | `fin-guru/config.yaml`, `fin-guru/framework/*.yaml` |
| **JSON** | API responses, MCP server config, CSV mappings | `.mcp.json`, `docs/csv-mappings/*.json` |
| **CSV** | Data import (broker statements) | `docs/csv-mappings/vanguard-mapping.json`, etc. |
| **Excel** | Data export, historical records | Output via openpyxl/xlsxwriter |
| **Markdown** | Documentation | `CLAUDE.md`, guides, strategies |
| **PDF** | Report generation | Generated via reportlab |

## Database

| Component | Technology | Config |
|-----------|-----------|--------|
| **Database Engine** | PostgreSQL | `DATABASE_URL` environment variable |
| **ORM** | Drizzle ORM 0.38.0 | `apps/plaid-dashboard/db/drizzle.config.ts` |
| **Migrations** | Drizzle Kit 0.30.0 | `apps/plaid-dashboard/db/` |
| **Connection Pool** | postgres.js (10 connections) | `apps/plaid-dashboard/db/src/client.ts` |

**Schema Tables** (`apps/plaid-dashboard/db/src/schema.ts`):
- `bank_connections` — Plaid Link connections (institutionId, itemId, accessToken)
- `bank_accounts` — Individual accounts per connection
- `transactions` — Transaction history with posting status

## Development Environment

| Tool | Config | Purpose |
|------|--------|---------|
| **Virtual Environment** | `.venv/` | Python isolated environment (managed by uv) |
| **Cache Directories** | `.uv-cache/`, `.ruff_cache/`, `.pytest_cache/` | Build and tool caches |
| **Node Modules** | `node_modules/` | JavaScript dependencies (Bun-managed) |

## Summary by Focus Area

### Financial Analysis Tools
- **Data Source**: yfinance (primary, free), Finnhub (real-time), ITC Risk API (paid)
- **Computation**: NumPy, SciPy, Scikit-Learn, Pandas
- **Validation**: Pydantic v2 (all inputs/outputs)
- **Export**: JSON, Markdown, Excel, PDF

### Dashboard & Frontend
- **Framework**: Next.js 15 + React 19
- **Styling**: Tailwind CSS
- **State Management**: React Query (@tanstack/react-query)
- **API Integration**: Plaid Link (react-plaid-link 3.6.0)

### Backend API
- **Framework**: Hono 4.6.0
- **Validation**: Zod with Hono validator
- **Database**: PostgreSQL + Drizzle ORM
- **Runtime**: Bun 1.1.0

### Infrastructure
- **Monorepo**: Turbo 2.3.0
- **Package Manager**: Bun 1.1.0 (JavaScript), uv (Python)
- **CI/CD**: GitHub Actions + Claude Code
- **Configuration**: Environment variables (.env), YAML configs, JSON schemas
